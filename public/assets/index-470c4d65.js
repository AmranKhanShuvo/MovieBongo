import{D as T,o as P,p as e,q as l,F as m,I as y,B as N,x as S,y as c,z as n,r as o,s as _,v as x}from"./index-06ab806b.js";import{M as B,f as E,u as j,T as q,S as C,I as M,h as F,j as H,P as Y,e as O}from"./theatres-b7f46c8a.js";import{g as K}from"./movies-04e7ef00.js";import{g as L,a as R,d as V}from"./shows-50cef478.js";import{h as A}from"./moment-fbc5633a.js";import{g as z}from"./bookings-9b0775f2.js";const U=({openTheatreForm:d,setOpenTheatreForm:f,selectedTheatre:r,setSelectedTheatre:u,formType:a,fetchTheatres:g})=>{const{user:p}=T(w=>w.user),I=P();return e(B,{title:a==="add"?"ADD THEATRE":"EDIT THEATRE",open:d,onCancel:()=>{f(!1),u(void 0)},footer:null,maskClosable:!1,keyboard:!1,children:l(m,{layout:"vertical",onFinish:async w=>{try{I(S());let i;a==="add"?i=await E({...w,owner:p==null?void 0:p._id}):i=await j({...w,theatreId:r==null?void 0:r._id}),I(c()),i.success?(g(),f(!1),u(void 0),n.success(i.message)):n.error(i.error)}catch(i){I(c()),n.error(i.message)}},initialValues:r,children:[e(m.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please Input theatre Name."}],children:e(y,{})}),e(m.Item,{label:"Address",name:"address",rules:[{required:!0,message:"Please Input theatre address."}],children:e(y.TextArea,{})}),e(m.Item,{label:"Phone Number",name:"phone",rules:[{required:!0,message:"Please Input theatre phone number."}],children:e(y,{})}),e(m.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please Input theatre email address."}],children:e(y,{})}),l("div",{className:"flex justify-end gap-1",children:[e(N,{title:"Cancel",type:"button",variant:"outlined",onClick:()=>{f(!1),u(void 0)}}),e(N,{title:"Save",type:"submit"})]})]})})},$=({openShowModal:d,setOpenShowModal:f,selectedTheatre:r,setSelectedTheatre:u})=>{const[a,g]=o.useState("table"),[p,I]=o.useState(),[v,w]=o.useState(),i=P(),h=o.useCallback(async()=>{try{i(S());const s=await K(),t=await L({theatreId:r==null?void 0:r._id});i(c()),s.success?w(s.movies):n.error(s.message),t.success?I(t.shows):n.error(t.message)}catch(s){i(c()),n.error(s.message)}},[]),b=async s=>{try{i(S());const t=await R({...s,theatreId:r==null?void 0:r._id});i(c()),t.success?(h(),g("table"),n.success(t.message)):n.error(t.message)}catch(t){i(c()),n.error(t.message)}},k=async s=>{try{i(S());const t=await V({showId:s});i(c()),t.success?(h(),n.success(t.message)):n.error(t.message)}catch(t){i(c()),n.error(t.message)}},D=[{title:"Show",dataIndex:"showTitle"},{title:"Date",dataIndex:"date",render:(s,t)=>A(t.date).format("MMM Do YYYY")},{title:"Time",dataIndex:"time",render:(s,t)=>A(t.time,"HH:mm").format("hh:mm A")},{title:"Movie",dataIndex:"movieId",render:(s,t)=>t.movieId.title},{title:"Ticket Price",dataIndex:"ticketPrice"},{title:"Total Seats",dataIndex:"totalSeats"},{title:"Available Seats",dataIndex:"availableSeats",render:(s,t)=>t.totalSeats-t.bookedSeats.length},{title:"Action",dataIndex:"action",render:(s,t)=>e("div",{className:"flex gap-2 items-center",children:t.bookedSeats.length===0&&e("i",{className:"ri-close-circle-line text-danger",onClick:()=>{k(t._id)}})})}];return o.useEffect(()=>{h()},[]),l(B,{open:d,onCancel:()=>{f(!1),u(void 0)},width:1600,footer:null,keyboard:!1,maskClosable:!1,children:[l("h1",{className:"text-primary text-md uppercase mb-1",children:["Theatre: ",r==null?void 0:r.name]}),e("hr",{}),l("div",{className:"flex justify-between items-center mt-1 mb-1",children:[e("h1",{className:"text-md uppercase",children:a==="table"?"shows":"add show"}),a==="table"&&e(N,{title:"Add Show",variant:"outlined",onClick:()=>g("form")})]}),a==="table"&&e(q,{columns:D,dataSource:p,rowKey:s=>s._id}),a==="form"&&l(m,{layout:"vertical",onFinish:b,children:[l(_,{gutter:[16,16],children:[e(x,{span:8,children:e(m.Item,{label:"Show",name:"showTitle",rules:[{required:!0,message:"Please input show name."}],children:e(y,{})})}),e(x,{span:8,children:e(m.Item,{label:"Date",name:"date",rules:[{required:!0,message:"Please input show date."}],children:e(y,{type:"date",min:new Date().toISOString().split("T")[0]})})}),e(x,{span:8,children:e(m.Item,{label:"Time",name:"time",rules:[{required:!0,message:"Please input show time."}],children:e(y,{type:"time"})})}),e(x,{span:8,children:e(m.Item,{label:"Movie",name:"movieId",rules:[{required:!0,message:"Please input movie name."}],children:e(C,{defaultActiveFirstOption:!0,placeholder:"Select Movie",children:v==null?void 0:v.map(s=>e(C.Option,{value:s._id,children:s.title},s._id))})})}),e(x,{span:2,children:e(m.Item,{label:"Ticket Price",name:"ticketPrice",rules:[{required:!0,message:"Please input show ticket price."}],children:e(M,{})})}),e(x,{span:2,children:e(m.Item,{label:"Total Seats",name:"totalSeats",rules:[{required:!0,message:"Please input show total seats."}],children:e(M,{})})})]}),l("div",{className:"flex justify-end gap-1",children:[e(N,{title:"Cancel",type:"button",variant:"outlined",onClick:()=>g("table")}),e(N,{title:"Save",type:"submit"})]})]})]})},G=()=>{const{user:d}=T(s=>s.user),[f,r]=o.useState(),[u,a]=o.useState(!1),[g,p]=o.useState(),[I,v]=o.useState("add"),[w,i]=o.useState(!1),h=P(),b=o.useCallback(async()=>{try{h(S());const s=await F({owner:d==null?void 0:d._id});h(c()),s.success?r(s.theatres):n.error(s.message)}catch(s){h(c()),n.error(s.message)}},[h,d==null?void 0:d._id]),k=async s=>{try{h(S());const t=await H({theatreId:s});h(c()),t.success?(n.success(t.message),b()):n.error(t.message)}catch(t){h(c()),n.error(t.message)}},D=[{title:"Name",dataIndex:"name"},{title:"Address",dataIndex:"address",ellipsis:!0},{title:"Phone Number",dataIndex:"phone"},{title:"Email Address",dataIndex:"email"},{title:"Status",dataIndex:"isActive",render:(s,t)=>s?"Approved":"Pending/Blocked"},{title:"Action",dataIndex:"action",render:(s,t)=>l("div",{className:"flex gap-2 items-center",children:[e("i",{className:"ri-close-circle-line text-danger",onClick:()=>{k(t._id)}}),e("i",{className:"ri-pencil-fill text-primary",onClick:()=>{p(t),v("edit"),a(!0)}}),t.isActive&&e("span",{className:"underline",onClick:()=>{p(t),i(!0)},children:"Shows"})]})}];return o.useEffect(()=>{b()},[b]),l("div",{children:[e("div",{className:"flex justify-end mb-1",children:e(N,{title:"Add Theatre",variant:"outlined",onClick:()=>{v("add"),a(!0)}})}),e(q,{columns:D,dataSource:f,rowKey:s=>s._id}),u&&e(U,{openTheatreForm:u,setOpenTheatreForm:a,selectedTheatre:g,setSelectedTheatre:p,formType:I,fetchTheatres:b}),w&&e($,{openShowModal:w,setOpenShowModal:i,selectedTheatre:g,setSelectedTheatre:p})]})},J=()=>{const[d,f]=o.useState(),r=P(),u=o.useCallback(async()=>{try{r(S());const a=await z();r(c()),a.success?f(a.data):n.error(a.message)}catch(a){r(c()),n.error(a.message)}},[]);return o.useEffect(()=>{u()},[]),e("div",{children:e(_,{gutter:[16,16],children:d==null?void 0:d.map(a=>e(x,{span:12,children:l("div",{className:"card flex justify-between p-2 uppercase",children:[l("div",{children:[l("h1",{className:"text-xl",children:[a.show.movieId.title," (",a.show.movieId.language,")"]}),e("div",{className:"divider"}),l("h1",{className:"text-sm",children:[a.show.theatreId.name," (",a.show.theatreId.address,")"]}),l("h1",{className:"text-sm",children:["Date & Time: ",A(a.show.date).format("MMM Do YYYY")," ","- ",A(a.show.time,"HH:mm").format("hh:mm A")]}),l("h1",{className:"text-sm",children:["Amount Paid: $",a.show.ticketPrice*a.seats.length]}),l("h1",{className:"text-sm",children:["Booking ID: ",a._id]})]}),l("div",{children:[e("img",{src:a.show.movieId.poster,alt:"poster",height:100,width:100,className:"br-1"}),l("h1",{className:"text-sm",children:["Seats: ",a.seats.join(", ")]})]})]})},a._id))})})},se=()=>l("div",{children:[e(Y,{title:"profile"}),e(O,{defaultActiveKey:"1",items:[{key:"1",label:"Bookings",children:e(J,{})},{key:"2",label:"Theatres",children:e(G,{})}]})]});export{se as default};
